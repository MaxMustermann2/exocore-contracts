name: Comment the status of the CI run on the pull request

on:
  workflow_run:
    workflows: ["Forge CI", "Slither Analysis", "Run `solhint` linter"]
    types:
      - completed

permissions:
  pull-requests: write
  issues: read

jobs:
  comment_status:
    runs-on: ubuntu-latest
    steps:
      # Log the workflow trigger details for debugging.
      - name: Echo workflow trigger details
        run: |
          echo "Workflow run event: ${{ github.event.workflow_run.event }}"
          echo "Workflow run conclusion: ${{ github.event.workflow_run.conclusion }}"
          echo "Workflow run name: ${{ github.event.workflow_run.name }}"
          echo "Workflow run URL: ${{ github.event.workflow_run.html_url }}"
          echo "Commit SHA: ${{ github.event.workflow_run.head_commit.id }}"
          echo "Workflow Run ID: ${{ github.event.workflow_run.id }}"
      # Checkout the repository to make the composite action available.
      - name: Checkout repository
        uses: actions/checkout@v4
        if: ${{ github.event.workflow_run.event == 'pull_request' }}
      # Finally, run the composite action to post/update the status comment.
      - name: Update CI Status
        uses: ./.github/actions/composite-action-pr-status-comment
        if: ${{ github.event.workflow_run.event == 'pull_request' }}
        with:
          workflow-conclusion: ${{ github.event.workflow_run.conclusion }}
          workflow-url: ${{ github.event.workflow_run.html_url }}
          workflow-name: ${{ github.event.workflow_run.name }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
